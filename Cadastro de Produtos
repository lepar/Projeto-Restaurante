#include <stdio.h>
#include <stdlib.h>
#include <string.h>

struct produto preenche();

struct produto {
	int id;
    char nome[25], descricao[100], preco[6];
};

struct produto preenche(int contador)
{
    struct produto cliente;
	
    contador=contador+1;
    cliente.id=contador;
    setbuf (stdin, NULL);
    printf("\nNome do produto:");
	scanf("%[^\n]s", cliente.nome);
	setbuf (stdin, NULL);
	printf("\nDescricao do produto:");
	scanf("%[^\n]s", cliente.descricao);
	setbuf (stdin, NULL);
	printf("\nInforme o preco:");
	scanf("%[^\n]s", cliente.preco);
	setbuf (stdin, NULL);
    return cliente;
}

int produtos(int argc, char **argv)
{	
 int num=0, contador, resposta, aux=0, procurar=0, opcao=0, editar=0;
 struct produto *vetor;
 struct produto *auxvetor;
 
 do{
 
 printf("Escolha uma opcao:");
 printf("\n1 - Cadastrar produtos.");
 printf("\n2 - Editar um produto cadastrado.");
 printf("\n3 - Excluir um produto cadastrado.");
 printf("\n\n\nEntre com outro valor para sair. \n");
 scanf("%d", &opcao);
 switch (opcao)
 {
    case 1:
    {   
        
         vetor = malloc(num * sizeof(struct produto));
         while(1)
         {
           for(contador = aux; contador<num; contador++)
           {
              vetor[contador] = preenche(contador);
           }
           printf("\nDeseja cadastrar mais produtos ? \n Digite 1 para Sim ou 2 para Nao! \n");
           scanf("%d", &resposta);
           if(resposta==1)
           {
              aux = num;
              num = num + 1;
              auxvetor = malloc(aux * sizeof(struct produto));
              for(contador = 0; contador < aux; contador++)
              {
                 auxvetor[contador] = vetor[contador];
              }
              vetor = malloc(num * sizeof(struct produto));
              for(contador = 0; contador < aux; contador++)
              {
                 vetor[contador] = auxvetor[contador];
              }
            }
            else 
            //sair quando a resposta for nao
            { break; }
         }
    }
    break;
    case 2:
    {
      
         printf("\nEntre com a ID do produto:");
         scanf("%d", &editar);
         for(contador=0;contador<num;contador++)
         {
            if(vetor[contador].id == editar)
            {
               vetor[contador] = preenche(contador);
            }
         }
    }
    break;     
    case 3:
    {
   
         printf("\nEntre com a ID do produto:");
         scanf("%d", &editar);
         for(contador=0;contador<num;contador++)
         {
            if(vetor[contador].id == editar)
            {
               vetor[contador].id = 0;
            }
         }
    }
    break;
    case 4:
         return 0;
    break;
  }
 
  for(contador = 0; contador < num; contador++)
    {
      printf("\n\n\n ID: %d - NOME: %s - DESCRICAO: %s - PRECO: %s\n", vetor[contador].id, vetor[contador].nome, vetor[contador].descricao, vetor[contador].preco);
    }
 
 printf("\n\n\nDeseja retornar ao menu de produtos ? \n Digite 1 para Sim ou 2 para Nao! \n");
 scanf("%d", &opcao);
 }while(opcao==1);
    free(vetor);
    free(auxvetor);
}
